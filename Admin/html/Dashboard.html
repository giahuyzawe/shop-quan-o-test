<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta http-equiv="X-UA-Compatible" content="ie=edge" />
    <title>Product Admin - Dashboard HTML Template</title>
    <link
      rel="stylesheet"
      href="https://fonts.googleapis.com/css?family=Roboto:400,700"
    />
    <!-- https://fonts.google.com/specimen/Roboto -->
    <link rel="stylesheet" href="../css/fontawesome.min.css" />
    <!-- https://fontawesome.com/ -->
    <link rel="stylesheet" href="../css/bootstrap.min.css" />
    <!-- https://getbootstrap.com/ -->
    <link rel="stylesheet" href="../css/templatemo-style.css" />
  </head>

  <body id="reportsPage">
    <div id="home">
      <nav class="navbar navbar-expand-xl">
        <div class="container h-100">
          <a class="navbar-brand" href="index.html">
            <h1 class="tm-site-title mb-0">Male Fashion's Admin</h1>
          </a>
          <button
            class="navbar-toggler ml-auto mr-0"
            type="button"
            data-toggle="collapse"
            data-target="#navbarSupportedContent"
            aria-controls="navbarSupportedContent"
            aria-expanded="false"
            aria-label="Toggle navigation"
          >
            <i class="fas fa-bars tm-nav-icon"></i>
          </button>

          <div class="collapse navbar-collapse" id="navbarSupportedContent">
            <ul class="navbar-nav mx-auto h-100">
              <li class="nav-item">
                <a class="nav-link active" href="#"> Dashboard </a>
              </li>
              <li class="nav-item dropdown">
                <a
                  class="nav-link dropdown-toggle"
                  href="report.html"
                  id="navbarDropdown"
                  role="button"
                  data-toggle="dropdown"
                  aria-haspopup="true"
                  aria-expanded="false"
                >
                  Reports
                </a>
                <div class="dropdown-menu" aria-labelledby="navbarDropdown">
                  <a class="dropdown-item" href="report.html"> Report</a>
                </div>
              </li>
              <li class="nav-item">
                <a class="nav-link" href="addproducts.html"> Products </a>
              </li>

              <li class="nav-item">
                <a class="nav-link" href="accounts.html"> Accounts </a>
              </li>
            </ul>
            <ul class="navbar-nav">
              <li class="nav-item">
                <a class="nav-link d-block" href="login.html">
                  Admin, <b>Logout</b>
                </a>
              </li>
            </ul>
          </div>
        </div>
      </nav>

      <!-- Main content -->
      <div class="container">
        <div class="row">
          <div class="col">
            <p class="text-white mt-5 mb-5">Welcome back, <b>Admin</b></p>
          </div>
        </div>
        <!-- row -->
        <div class="container-fluid">
          <div class="row">
            <div class="col-12">
              <h1 class="my-4">Business Dashboard</h1>

              <!-- Date Range Filter -->
              <div class="d-flex justify-content-between mb-4">
                <div>
                  <label for="startDate">Start Date:</label>
                  <input type="date" id="startDate" value="2024-12-01" />
                </div>
                <div>
                  <label for="endDate">End Date:</label>
                  <input type="date" id="endDate" />
                </div>
                <button class="btn btn-primary" onclick="filterData()">
                  Filter
                </button>
              </div>

              <!-- Product Sales Statistics -->
              <div class="row">
                <div class="col-md-6">
                  <div class="card">
                    <div class="card-header">
                      <h3>Product Sales Statistics</h3>
                    </div>
                    <div class="card-body">
                      <table class="table table-striped">
                        <thead>
                          <tr>
                            <th>Product Name</th>
                            <th>Quantity Sold</th>
                            <th>Total Revenue</th>
                            <th>View Invoice</th>
                          </tr>
                        </thead>
                        <tbody id="productTable">
                          <!-- Product data will go here -->
                        </tbody>
                      </table>
                      <p>
                        <strong>Total Revenue: </strong
                        ><span id="totalRevenue"></span>
                      </p>
                      <p>
                        <strong>Most Popular Product: </strong
                        ><span id="mostPopular"></span>
                      </p>
                      <p>
                        <strong>Least Popular Product: </strong
                        ><span id="leastPopular"></span>
                      </p>
                    </div>
                  </div>
                </div>

                <!-- Customer Sales Statistics -->
                <div class="col-md-6">
                  <div class="card">
                    <div class="card-header">
                      <h3>Top 5 Customers</h3>
                    </div>
                    <div class="card-body">
                      <table class="table table-striped">
                        <thead>
                          <tr>
                            <th>Customer Name</th>
                            <th>Total Revenue</th>
                            <th>View Invoice</th>
                          </tr>
                        </thead>
                        <tbody id="customerTable">
                          <!-- Customer data will go here -->
                        </tbody>
                      </table>
                      <p>
                        <strong>Total Revenue from Top 5 Customers: </strong
                        ><span id="topCustomersRevenue"></span>
                      </p>
                    </div>
                  </div>
                </div>
              </div>

              <!-- Chart for Revenue Over Time -->
              <div class="row mt-4">
                <div class="col-12">
                  <canvas id="revenueChart"></canvas>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
      <!-- Footer Section -->
      <footer class="text-center mt-5 py-4">
        <p>&copy; 2024 Male Fashion's Admin. All Rights Reserved.</p>
        <p>Designed by Your Name</p>
      </footer>

      <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/js/bootstrap.bundle.min.js"></script>
      <script>
        // Giữ nguyên dữ liệu mẫu hiện tại
        const productData = [
          {
            name: "Pique Biker Jacket",
            quantity: 15,
            price: 45.0,
            id: 1,
            revenue: 45.0 * 15,
          },
          {
            name: "Black Sneaker",
            quantity: 12,
            price: 35.0,
            id: 2,
            revenue: 35.0 * 12,
          },
          {
            name: "Brown Hooded Shirt Jacket",
            quantity: 8,
            price: 55.0,
            id: 3,
            revenue: 55.0 * 80,
          },
          {
            name: "Gray Fringed Scarf",
            quantity: 21,
            price: 30.0,
            id: 4,
            revenue: 30.0 * 21,
          },
          {
            name: "Black Floral Graphic T-Shirt",
            quantity: 29,
            price: 25.0,
            id: 5,
            revenue: 25.0 * 29,
          },
          {
            name: "Perfume Set",
            quantity: 2,
            price: 75.0,
            id: 6,
            revenue: 75.0 * 2,
          },
          {
            name: "White Utility Backpack",
            quantity: 4,
            price: 50.0,
            id: 7,
            revenue: 50.0 * 4,
          },
          {
            name: "Comouflage Hooded Jacket",
            quantity: 10,
            price: 60.0,
            id: 8,
            revenue: 60.0 * 10,
          },
          {
            name: "Brown Leather Backpack",
            quantity: 45,
            price: 80.0,
            id: 9,
            revenue: 80.0 * 45,
          },
          {
            name: "Gold Rectangular Cufflinks",
            quantity: 30,
            price: 40.0,
            id: 10,
            revenue: 40.0 * 30,
          },
          {
            name: "Fringed Black Scarf",
            quantity: 6,
            price: 35.0,
            id: 11,
            revenue: 35.0 * 6,
          },
          {
            name: "Navy Henley T-shirt",
            quantity: 30,
            price: 20.0,
            id: 12,
            revenue: 20.0 * 30,
          },
        ];

        const customerData = [
          { name: "Ta Quang Trung", revenue: 960, id: 1 },
          { name: "Huynh Ngoc Truc", revenue: 610, id: 2 },
          { name: "Ngo Nguyen Thanh Nhan", revenue: 520, id: 3 },
          { name: "Pham Tran Minh Khang", revenue: 375, id: 4 },
          { name: "Vu Gia Huy", revenue: 285, id: 5 },
        ];

        // Hàm hiển thị bảng sản phẩm
        function renderProductTable() {
          let totalRevenue = 0;
          let mostPopular = productData[0];
          let leastPopular = productData[0];

          let tableHTML = "";
          productData.forEach((product) => {
            totalRevenue += product.revenue;

            // Update the most popular product based on quantity
            if (product.quantity > mostPopular.quantity) mostPopular = product;

            // Update the least popular product based on quantity
            if (product.quantity < leastPopular.quantity)
              leastPopular = product;

            tableHTML += `
            <tr>
                <td>${product.name}</td>
                <td>${product.quantity}</td>
                <td>$${product.revenue}</td>
                <td><a href="invoice-customer-${product.id}.html">View Invoice</a></td>
            </tr>
        `;
          });

          document.getElementById("productTable").innerHTML = tableHTML;
          document.getElementById(
            "totalRevenue"
          ).innerText = `$${totalRevenue}`;
          document.getElementById("mostPopular").innerText = mostPopular.name;
          document.getElementById("leastPopular").innerText = leastPopular.name;
        }

        // Hàm hiển thị bảng khách hàng
        function renderCustomerTable() {
          let topCustomersRevenue = 0;
          let tableHTML = "";
          customerData.forEach((customer) => {
            topCustomersRevenue += customer.revenue;

            tableHTML += `
                        <tr>
                            <td>${customer.name}</td>
                            <td>$${customer.revenue}</td>
                            <td><a href="invoice-product-${customer.id}.html">View Invoice</a></td>
                        </tr>
                    `;
          });

          document.getElementById("customerTable").innerHTML = tableHTML;
          document.getElementById(
            "topCustomersRevenue"
          ).innerText = `$${topCustomersRevenue}`;
        }

        // Hàm hiển thị biểu đồ doanh thu theo thời gian
        function renderRevenueChart() {
          var ctx = document.getElementById("revenueChart").getContext("2d");
          var revenueChart = new Chart(ctx, {
            type: "line",
            data: {
              labels: ["Jan", "Feb", "Mar", "Apr", "May", "Jun"],
              datasets: [
                {
                  label: "Revenue",
                  data: [1200, 1500, 1300, 1700, 1600, 1900],
                  borderColor: "rgba(75, 192, 192, 1)",
                  borderWidth: 1,
                  fill: false,
                },
              ],
            },
          });
        }

        // Hàm lọc dữ liệu theo ngày
        // Sao lưu dữ liệu gốc
        // Sao lưu dữ liệu gốc
        const originalProductData = JSON.parse(JSON.stringify(productData)); // Deep copy

        // Sao lưu dữ liệu gốc

        function filterData() {
          const startDate = document.getElementById("startDate").value;
          const endDate = document.getElementById("endDate").value;

          // Kiểm tra ngày bắt đầu và ngày kết thúc
          if (!startDate || !endDate) {
            alert("Vui lòng nhập đầy đủ ngày bắt đầu và ngày kết thúc!");
            return;
          }

          const startDateObj = new Date(startDate);
          const endDateObj = new Date(endDate);

          if (startDateObj.getDate() !== 1 || endDateObj.getDate() !== 30) {
            alert(
              "Dữ liệu thống kê bắt buộc phải chọn ngày bắt đầu là ngày 1 và ngày kết thúc là ngày 30 của tháng!"
            );
            return;
          }

          // Ngày cơ sở
          const baseDateStart = new Date("2024-12-01");
          const baseDateEnd = new Date("2024-12-30");

          productData.forEach((product) => {
            if (endDateObj < baseDateStart) {
              // Nếu trước khoảng thời gian gốc, giảm quantity
              product.quantity = Math.max(
                0,
                originalProductData.find((p) => p.id === product.id).quantity -
                  5
              );
            } else if (startDateObj > baseDateEnd) {
              // Nếu sau khoảng thời gian gốc, tăng quantity
              product.quantity =
                originalProductData.find((p) => p.id === product.id).quantity +
                5;
            } else {
              // Nếu trong khoảng thời gian gốc, giữ nguyên dữ liệu
              product.quantity = originalProductData.find(
                (p) => p.id === product.id
              ).quantity;
            }
            product.revenue = product.quantity * product.price; // Tính lại revenue
          });

          // Cập nhật lại bảng
          renderProductTable();
          renderCustomerTable();
        }
      </script>
    </div>
  </body>
</html>
